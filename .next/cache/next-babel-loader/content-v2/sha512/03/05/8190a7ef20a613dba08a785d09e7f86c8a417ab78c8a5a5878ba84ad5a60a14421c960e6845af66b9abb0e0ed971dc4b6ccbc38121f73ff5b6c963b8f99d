{"ast":null,"code":"import prisma from \"../../contexts/prisma\";\nimport { getSession } from \"next-auth/client\";\nimport { hashSync } from \"bcrypt\";\nexport default (async (req, res) => {\n  const session = await getSession({\n    req\n  });\n\n  if (req.method === \"GET\") {\n    const user = await prisma.user.findUnique({\n      where: {\n        id: session.user.id\n      },\n      include: {\n        requester: true,\n        accepter: true,\n        recipient: true\n      }\n    });\n    return res.json(user);\n  } else if (req.method === \"POST\") {\n    const user = req.body;\n    delete user.balance;\n    if (user.password) user.password = hashSync(user.password, 10);\n\n    try {\n      const updatedUser = await prisma.user.update({\n        where: {\n          id: session.user.id\n        },\n        data: user\n      });\n      return res.json(updatedUser);\n    } catch (e) {\n      console.log(e.meta.target);\n\n      if (e.code === \"P2002\") {\n        return res.json({\n          error: `There's already an account with that ${e.meta.target[0]}`\n        });\n      } // throw e;\n\n    }\n  }\n});","map":{"version":3,"sources":["/Users/colechalland/Projects/CryptoCurrency/BEToken/pages/api/currentUser.js"],"names":["prisma","getSession","hashSync","req","res","session","method","user","findUnique","where","id","include","requester","accepter","recipient","json","body","balance","password","updatedUser","update","data","e","console","log","meta","target","code","error"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,uBAAnB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,QAAT,QAAyB,QAAzB;AAEA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAClC,QAAMC,OAAO,GAAG,MAAMJ,UAAU,CAAC;AAAEE,IAAAA;AAAF,GAAD,CAAhC;;AAEA,MAAIA,GAAG,CAACG,MAAJ,KAAe,KAAnB,EAA0B;AACzB,UAAMC,IAAI,GAAG,MAAMP,MAAM,CAACO,IAAP,CAAYC,UAAZ,CAAuB;AACzCC,MAAAA,KAAK,EAAE;AACNC,QAAAA,EAAE,EAAEL,OAAO,CAACE,IAAR,CAAaG;AADX,OADkC;AAIzCC,MAAAA,OAAO,EAAE;AACRC,QAAAA,SAAS,EAAE,IADH;AAERC,QAAAA,QAAQ,EAAE,IAFF;AAGRC,QAAAA,SAAS,EAAE;AAHH;AAJgC,KAAvB,CAAnB;AAUA,WAAOV,GAAG,CAACW,IAAJ,CAASR,IAAT,CAAP;AACA,GAZD,MAYO,IAAIJ,GAAG,CAACG,MAAJ,KAAe,MAAnB,EAA2B;AACjC,UAAMC,IAAI,GAAGJ,GAAG,CAACa,IAAjB;AACA,WAAOT,IAAI,CAACU,OAAZ;AACA,QAAIV,IAAI,CAACW,QAAT,EAAmBX,IAAI,CAACW,QAAL,GAAgBhB,QAAQ,CAACK,IAAI,CAACW,QAAN,EAAgB,EAAhB,CAAxB;;AAEnB,QAAI;AACH,YAAMC,WAAW,GAAG,MAAMnB,MAAM,CAACO,IAAP,CAAYa,MAAZ,CAAmB;AAC5CX,QAAAA,KAAK,EAAE;AACNC,UAAAA,EAAE,EAAEL,OAAO,CAACE,IAAR,CAAaG;AADX,SADqC;AAI5CW,QAAAA,IAAI,EAAEd;AAJsC,OAAnB,CAA1B;AAMA,aAAOH,GAAG,CAACW,IAAJ,CAASI,WAAT,CAAP;AACA,KARD,CAQE,OAAOG,CAAP,EAAU;AACXC,MAAAA,OAAO,CAACC,GAAR,CAAYF,CAAC,CAACG,IAAF,CAAOC,MAAnB;;AACA,UAAIJ,CAAC,CAACK,IAAF,KAAW,OAAf,EAAwB;AACvB,eAAOvB,GAAG,CAACW,IAAJ,CAAS;AAAEa,UAAAA,KAAK,EAAG,wCAAuCN,CAAC,CAACG,IAAF,CAAOC,MAAP,CAAc,CAAd,CAAiB;AAAlE,SAAT,CAAP;AACA,OAJU,CAKX;;AACA;AACD;AACD,CApCD","sourcesContent":["import prisma from \"../../contexts/prisma\";\nimport { getSession } from \"next-auth/client\";\nimport { hashSync } from \"bcrypt\";\n\nexport default async (req, res) => {\n\tconst session = await getSession({ req });\n\n\tif (req.method === \"GET\") {\n\t\tconst user = await prisma.user.findUnique({\n\t\t\twhere: {\n\t\t\t\tid: session.user.id,\n\t\t\t},\n\t\t\tinclude: {\n\t\t\t\trequester: true,\n\t\t\t\taccepter: true,\n\t\t\t\trecipient: true,\n\t\t\t},\n\t\t});\n\t\treturn res.json(user);\n\t} else if (req.method === \"POST\") {\n\t\tconst user = req.body;\n\t\tdelete user.balance;\n\t\tif (user.password) user.password = hashSync(user.password, 10);\n\n\t\ttry {\n\t\t\tconst updatedUser = await prisma.user.update({\n\t\t\t\twhere: {\n\t\t\t\t\tid: session.user.id,\n\t\t\t\t},\n\t\t\t\tdata: user,\n\t\t\t});\n\t\t\treturn res.json(updatedUser);\n\t\t} catch (e) {\n\t\t\tconsole.log(e.meta.target);\n\t\t\tif (e.code === \"P2002\") {\n\t\t\t\treturn res.json({ error: `There's already an account with that ${e.meta.target[0]}` });\n\t\t\t}\n\t\t\t// throw e;\n\t\t}\n\t}\n};\n"]},"metadata":{},"sourceType":"module"}