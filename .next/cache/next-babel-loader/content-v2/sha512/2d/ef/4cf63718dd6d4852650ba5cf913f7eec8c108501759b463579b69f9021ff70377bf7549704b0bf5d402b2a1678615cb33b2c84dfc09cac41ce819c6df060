{"ast":null,"code":"import prisma from \"../../contexts/prisma\";\nimport { getSession } from \"next-auth/client\";\nimport { hashSync } from \"bcrypt\";\nexport default (async (req, res) => {\n  const session = await getSession({\n    req\n  });\n\n  if (req.method === \"GET\") {\n    const user = await prisma.user.findUnique({\n      where: {\n        id: session.user.id\n      },\n      include: {\n        requester: true,\n        accepter: true\n      }\n    });\n    return res.json(user);\n  } else if (req.method === \"POST\") {\n    const user = req.body;\n    delete user.balance;\n    if (user.password) user.password = hashSync(user.password, 10);\n\n    try {\n      const updatedUser = await prisma.user.update({\n        where: {\n          id: session.user.id\n        },\n        data: user\n      });\n      return res.json(updatedUser);\n    } catch (e) {\n      if (e instanceof Prisma.PrismaClientKnownRequestError) {\n        // The .code property can be accessed in a type-safe manner\n        if (e.code === \"P2002\") {\n          console.log(e);\n        }\n      }\n\n      throw e;\n    }\n  }\n});","map":{"version":3,"sources":["/Users/colechalland/Projects/CryptoCurrency/BEToken/pages/api/currentUser.js"],"names":["prisma","getSession","hashSync","req","res","session","method","user","findUnique","where","id","include","requester","accepter","json","body","balance","password","updatedUser","update","data","e","Prisma","PrismaClientKnownRequestError","code","console","log"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,uBAAnB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,QAAT,QAAyB,QAAzB;AAEA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAClC,QAAMC,OAAO,GAAG,MAAMJ,UAAU,CAAC;AAAEE,IAAAA;AAAF,GAAD,CAAhC;;AAEA,MAAIA,GAAG,CAACG,MAAJ,KAAe,KAAnB,EAA0B;AACzB,UAAMC,IAAI,GAAG,MAAMP,MAAM,CAACO,IAAP,CAAYC,UAAZ,CAAuB;AACzCC,MAAAA,KAAK,EAAE;AACNC,QAAAA,EAAE,EAAEL,OAAO,CAACE,IAAR,CAAaG;AADX,OADkC;AAIzCC,MAAAA,OAAO,EAAE;AACRC,QAAAA,SAAS,EAAE,IADH;AAERC,QAAAA,QAAQ,EAAE;AAFF;AAJgC,KAAvB,CAAnB;AASA,WAAOT,GAAG,CAACU,IAAJ,CAASP,IAAT,CAAP;AACA,GAXD,MAWO,IAAIJ,GAAG,CAACG,MAAJ,KAAe,MAAnB,EAA2B;AACjC,UAAMC,IAAI,GAAGJ,GAAG,CAACY,IAAjB;AACA,WAAOR,IAAI,CAACS,OAAZ;AACA,QAAIT,IAAI,CAACU,QAAT,EAAmBV,IAAI,CAACU,QAAL,GAAgBf,QAAQ,CAACK,IAAI,CAACU,QAAN,EAAgB,EAAhB,CAAxB;;AAEnB,QAAI;AACH,YAAMC,WAAW,GAAG,MAAMlB,MAAM,CAACO,IAAP,CAAYY,MAAZ,CAAmB;AAC5CV,QAAAA,KAAK,EAAE;AACNC,UAAAA,EAAE,EAAEL,OAAO,CAACE,IAAR,CAAaG;AADX,SADqC;AAI5CU,QAAAA,IAAI,EAAEb;AAJsC,OAAnB,CAA1B;AAMA,aAAOH,GAAG,CAACU,IAAJ,CAASI,WAAT,CAAP;AACA,KARD,CAQE,OAAOG,CAAP,EAAU;AACX,UAAIA,CAAC,YAAYC,MAAM,CAACC,6BAAxB,EAAuD;AACtD;AACA,YAAIF,CAAC,CAACG,IAAF,KAAW,OAAf,EAAwB;AACvBC,UAAAA,OAAO,CAACC,GAAR,CAAYL,CAAZ;AACA;AACD;;AACD,YAAMA,CAAN;AACA;AACD;AACD,CArCD","sourcesContent":["import prisma from \"../../contexts/prisma\";\nimport { getSession } from \"next-auth/client\";\nimport { hashSync } from \"bcrypt\";\n\nexport default async (req, res) => {\n\tconst session = await getSession({ req });\n\n\tif (req.method === \"GET\") {\n\t\tconst user = await prisma.user.findUnique({\n\t\t\twhere: {\n\t\t\t\tid: session.user.id,\n\t\t\t},\n\t\t\tinclude: {\n\t\t\t\trequester: true,\n\t\t\t\taccepter: true,\n\t\t\t},\n\t\t});\n\t\treturn res.json(user);\n\t} else if (req.method === \"POST\") {\n\t\tconst user = req.body;\n\t\tdelete user.balance;\n\t\tif (user.password) user.password = hashSync(user.password, 10);\n\n\t\ttry {\n\t\t\tconst updatedUser = await prisma.user.update({\n\t\t\t\twhere: {\n\t\t\t\t\tid: session.user.id,\n\t\t\t\t},\n\t\t\t\tdata: user,\n\t\t\t});\n\t\t\treturn res.json(updatedUser);\n\t\t} catch (e) {\n\t\t\tif (e instanceof Prisma.PrismaClientKnownRequestError) {\n\t\t\t\t// The .code property can be accessed in a type-safe manner\n\t\t\t\tif (e.code === \"P2002\") {\n\t\t\t\t\tconsole.log(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthrow e;\n\t\t}\n\t}\n};\n"]},"metadata":{},"sourceType":"module"}